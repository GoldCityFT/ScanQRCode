<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>My LIFF Test</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body 
    {
      margin: 0;
      padding: 0;
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(135deg, #00C300, #00A86B);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }
    h1 
    {
      font-size: 2.5rem;
      margin-bottom: 20px;
    }
    button 
    {
      background: #ffffff;
      color: #00A86B;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    button:hover 
    {
      background: #00A86B;
      color: white;
      transform: scale(1.05);
    }
    a.back-link 
    {
      color: white;
      font-weight: bold;
      text-decoration: none;
      margin-top: 20px;
      display: inline-block;
      padding: 10px 20px;
      border: 2px solid white;
      border-radius: 30px;
      transition: all 0.3s ease;
    }
    a.back-link:hover 
    {
      background: white;
      color: #00A86B;
    }
  </style>
</head>
<body>
  <h2 id="welcome"></h2>
  <button id="gotoGold">Go to Gold City</button>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // Init LIFF
      await liff.init({ liffId: "2007956346-G5BmkAQl" });

      // ดึงข้อมูล profile
      const profile = await liff.getProfile();
      const userId = profile.userId;
      const displayName = profile.displayName;

      // ส่งข้อมูลไปยัง n8n Webhook
      const response = await fetch("https://183.88.219.251:5678/webhook/AddLineUser", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, displayName })
      });

      if (!response.ok) {
        console.error("❌ Error saving user:", await response.text());
      } else {
        console.log("✅ User saved successfully");
      }

      // แสดงชื่อผู้ใช้บนจอ
      document.getElementById("welcome").innerText = "Hello, " + displayName;

      // ปุ่มไป goldcity
      document.getElementById("gotoGold").addEventListener("click", () => {
        window.location.href = "https://goldcityshop.com/";
      });

    } catch (err) {
      console.error("LIFF init or fetch error:", err);
      alert("เกิดข้อผิดพลาด กรุณาลองใหม่");
    }
  });
</script>

</body>
</html>
